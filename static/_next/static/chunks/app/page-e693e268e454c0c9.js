(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8343:function(e,t,r){Promise.resolve().then(r.bind(r,9031))},9031:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var s=r(7437),n=r(2265);r(1068);var a=e=>{let{messages:t,messagesEndRef:r}=e,[a,o]=(0,n.useState)(!1),i=e=>{navigator.clipboard.writeText(e).then(()=>{console.log("Text copied to clipboard"),o(!0),setTimeout(()=>o(!1),2e3)},e=>console.error("Could not copy text: ",e))};return(0,s.jsxs)("div",{style:{height:"450px",overflowY:"auto",marginBottom:"10px",padding:"10px",border:"1px solid #ccc",borderRadius:"8px",whiteSpace:"pre-wrap"},children:[t.map((e,t)=>(0,s.jsx)("div",{style:{textAlign:"user"===e.type?"right":"left",margin:"10px 0"},children:"image"===e.type?(0,s.jsx)("img",{src:e.imageUrl,alt:"Uploaded",style:{margin:"0 0 0 auto",maxWidth:"200px",maxHeight:"200px",borderRadius:"8px"}}):(0,s.jsx)("span",{style:{padding:"10px",borderRadius:"20px",background:"user"===e.type?"#007bff":"#eee",color:"user"===e.type?"white":"black",display:"inline-block",maxWidth:"70%",wordWrap:"break-word",fontSize:"system"===e.role?"13px":"15px",fontStyle:"system"===e.role?"italic":"normal",cursor:"default"},onClick:()=>i(e.text),children:e.text})},t)),a&&(0,s.jsx)("div",{style:{fontSize:"13px",position:"fixed",bottom:"50px",left:"50%",transform:"translateX(-50%)",background:"green",color:"white",padding:"8px",borderRadius:"4px",zIndex:1e3},children:"已复制到剪贴板"}),(0,s.jsx)("div",{ref:r})]})},o=e=>{let{onUpload:t}=e,[r,a]=(0,n.useState)(null),[o,i]=(0,n.useState)(!1),l=[".txt",".docx",".pdf"],c=async()=>{if(r){i(!0);try{await t(r)}catch(e){console.error("上传失败:",e)}i(!1)}else alert("请选择一个文件上传！")};return(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"10px"},children:[(0,s.jsx)("input",{type:"file",accept:l.join(","),onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&(r.size>5242880?(alert("文件大小不能超过5MB！"),e.target.value="",a(null)):a(r))},style:{marginRight:"10px",fontSize:"13px",padding:"6px",borderRadius:"5px",border:"1px solid #ccc"},title:"支持格式: ".concat(l.map(e=>"".concat(e)).join("/"))}),(0,s.jsx)("button",{onClick:c,style:{padding:"6px 10px",marginRight:"5px",borderRadius:"5px",border:"1px solid #ccc",background:o?"#ccc":"#004080",color:"white",fontSize:"14px",cursor:"pointer"},children:o?"文件处理":"上传文件"})]})};let i="https://chatbot-n.azurewebsites.net/";var l=e=>{let{uploadedFiles:t,onFileSelect:r,refreshTrigger:a}=e,[o,l]=(0,n.useState)([]),[c,d]=(0,n.useState)(null),p=async()=>{try{let e=await fetch(i+"get-filenames",{method:"GET",credentials:"include"});if(!e.ok)throw Error("Network response was not ok");let r=await e.json();t.length>0&&r.push(t[t.length-1]),l(r),t.length>0&&r.length>0&&d(r[r.length-1])}catch(e){console.error("Error:",e)}};(0,n.useEffect)(()=>{p()},[a]);let u=async()=>{try{if(!(await fetch(i+"clear",{method:"POST",credentials:"include"})).ok)throw Error("Network response was not ok");p()}catch(e){console.error("Error:",e)}},x=e=>{d(e),r(e)};return(0,s.jsxs)("div",{style:{width:"200px",borderRight:"1px solid #ccc",padding:"20px"},children:[(0,s.jsx)("h2",{style:{fontSize:"14px",marginBottom:"10px"},children:"已上传文件"}),(0,s.jsx)("ul",{style:{listStyle:"none",padding:10,border:"1px solid #ccc",borderRadius:"5px",backgroundColor:"#f9f9f9",marginBottom:"10px"},children:o.map((e,t)=>(0,s.jsx)("li",{style:{marginBottom:"5px",cursor:"pointer"},onClick:()=>x(e),children:(0,s.jsx)("span",{style:{backgroundColor:c===e?"#004080":"transparent",color:c===e?"white":"black",padding:"5px 10px",borderRadius:"5px",display:"inline-block",wordBreak:"break-word",fontSize:"13px"},children:e})},t))}),(0,s.jsx)("button",{style:{float:"right",fontSize:"12px",border:"1px solid #ccc",borderRadius:"5px",padding:"5px 10px"},onClick:u,children:"清除文件"})]})},c=function(e){let{onLoginSuccess:t}=e,[r,a]=(0,n.useState)(""),[o,i]=(0,n.useState)(""),[l,c]=(0,n.useState)(""),d=async e=>{e.preventDefault();try{let e=await fetch("https://chatbot-n.azurewebsites.net/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,password:o}),credentials:"include"});if(e.ok){let r=await e.json();t(r)}else c("登录失败：用户名或密码错误")}catch(e){console.error("登录错误:",e),c("登录时出现错误，请稍后再试")}};return(0,s.jsx)("div",{className:"d-flex justify-content-center align-items-center vh-100",children:(0,s.jsxs)("form",{className:"card p-3",style:{width:"400px",margin:"0 auto"},onSubmit:d,children:[(0,s.jsx)("h1",{className:"text-center mb-4",children:"Login"}),l&&(0,s.jsx)("div",{className:"alert alert-danger",children:l}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"username",children:"Username"}),(0,s.jsx)("input",{type:"text",className:"form-control",id:"username",name:"username",required:!0,value:r,onChange:e=>a(e.target.value)})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"password",children:"Password"}),(0,s.jsx)("input",{type:"password",className:"form-control",id:"password",name:"password",required:!0,value:o,onChange:e=>i(e.target.value)})]}),(0,s.jsx)("br",{}),(0,s.jsx)("button",{type:"submit",className:"btn btn-primary align-self-center",children:"Login"})]})})};let d="https://chatbot-n.azurewebsites.net/";function p(){let[e,t]=(0,n.useState)([{type:"system",role:"system",text:"请提问，文档问答请先选择文件并上传；根据文档内容撰写文章指令需以“写作”开头。"}]),[r,i]=(0,n.useState)(""),[p,u]=(0,n.useState)(!1),x=(0,n.useRef)(null),[h,f]=(0,n.useState)([]),[m,g]=(0,n.useState)(null),[y,b]=(0,n.useState)(!1),[j,w]=(0,n.useState)(3),[v,S]=(0,n.useState)(!1),[k,R]=(0,n.useState)(!0);(0,n.useEffect)(()=>{document.title="文档助手Chatbot"},[]),(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch(d+"check_session",{credentials:"include"});if(e.ok){let t=await e.json();S(!0),t.user_id&&(document.title="文档助手Chatbot - ".concat(t.user_id))}else S(!1)}catch(e){console.error("检查会话失败:",e)}finally{R(!1)}})()},[]);let _=()=>{var e;null===(e=x.current)||void 0===e||e.scrollIntoView({behavior:"auto"})};(0,n.useEffect)(()=>{_()},[e]);let[C,E]=(0,n.useState)(""),[N,O]=(0,n.useState)({});(0,n.useEffect)(()=>{fetch(d+"prompts",{credentials:"include"}).then(e=>e.json()).then(e=>{O(e),e&&Object.keys(e).length>0&&E(Object.keys(e)[0])}).catch(e=>console.error("Error fetching prompts:",e))},[]);let T=async e=>{let t=new FormData;t.append("file",e);try{(await fetch(d+"upload",{method:"POST",body:t,credentials:"include"})).ok?(alert("文件上传成功！较长文档需等待系统处理10秒以上再检索。"),E("1"),h.includes(e.name)||f(t=>[...t,e.name]),g(e.name)):alert("文件上传失败！")}catch(e){console.error("上传错误:",e)}b(e=>!e)},z=async()=>{let e=Date.now();t(t=>[...t,{type:"user",text:r},{type:"system",text:"思考中......",role:"system",id:e}]),u(!0);let s=async r=>{let s=new TextDecoder,n="";for(;;){let{value:a,done:o}=await r.read();if(o)break;let i=s.decode(a,{stream:!0});if(i.startsWith("data: "))try{(i=i.replace(/data: /g,"")).split("\n\n").forEach(e=>{if(e=e.trim(),""!==e)try{let t=JSON.parse(e);n+=t.data}catch(t){console.error("Error parsing JSON:",t,"in message:",e)}});let r=/\n\*\*\*[^*]+?\*\*\*(?=\n|$)/g,s=/-----/;if(r.test(n)){if(s.test(n))n=n.replace(r,"");else{let e=n.match(r);if(e&&e.length>1)for(let t=0;t<e.length-1;t++)n=n.replace(e[t],"")}}else n=n.replace(/\n\*\*\*[^*]+?\*\*\*/,"");t(t=>t.map(t=>t.id===e?{...t,text:n,role:"assistant"}:t))}catch(e){console.error("Error parsing message:",e)}}};try{let e=await fetch(d+"message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_input:r,prompt_template:C,selected_file:m,n:j}),credentials:"include"});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));if(e.body){let t=e.body.getReader();s(t)}else console.error("Response body is null")}catch(e){console.error("Error sending message:",e)}i(""),u(!1)};return k?(0,s.jsx)("div",{children:"Loading..."}):(0,s.jsx)("div",{style:{display:"flex",height:"100vh",alignItems:"center",justifyContent:"center"},children:v?(0,s.jsxs)("div",{style:{display:"flex",width:"100%",alignItems:"center",justifyContent:"center"},children:[(0,s.jsxs)("div",{style:{width:"80%",maxWidth:"600px"},children:[(0,s.jsx)("div",{className:"row",children:(0,s.jsx)("div",{className:"col-12 text-center",children:(0,s.jsx)("h3",{children:"AI-assisted Writer"})})}),(0,s.jsx)(a,{messages:e,messagesEndRef:x})," ",(0,s.jsxs)("div",{style:{display:"flex",marginBottom:"20px",alignItems:"center"},children:[(0,s.jsx)("select",{style:{width:"175px"},value:C,onChange:e=>E(e.target.value),className:"custom-select",children:Object.entries(N).map((e,t)=>{let[r,n]=e;return(0,s.jsx)("option",{value:t,children:"string"==typeof n?n:String(n)},r)})}),(0,s.jsx)("textarea",{value:r,onChange:e=>i(e.target.value),style:{fontSize:"14px",flex:1,padding:"6px",paddingLeft:"10px",borderRadius:"5px",border:"1px solid #ccc",marginRight:"5px"},disabled:p,rows:3,placeholder:"在此输入..."}),(0,s.jsx)("button",{onClick:z,style:{padding:"5px",borderRadius:"5px",border:"1px solid #ccc",background:p?"#ccc":"#007bff",color:p?"#666":"white",width:"70px",marginRight:"5px",fontSize:"14px"},disabled:p,children:p?"已发送":"发送"})]}),(0,s.jsxs)("div",{style:{display:"flex",marginBottom:"20px",alignItems:"center",justifyContent:"flex-end"},children:[(0,s.jsx)("label",{style:{marginRight:"10px",fontSize:"13px"},children:"Choices"}),(0,s.jsx)("input",{type:"range",min:"1",max:"3",value:j,onChange:e=>w(Number(e.target.value)),className:"form-range",style:{marginRight:"10px",width:"80px"},title:"回复数量1~3"}),(0,s.jsx)("span",{style:{marginRight:"45px",fontSize:"13px"},children:j}),(0,s.jsx)(o,{onUpload:T})," "]})]}),(0,s.jsx)(l,{uploadedFiles:h,onFileSelect:e=>{g(e),E("1")},refreshTrigger:y})]}):(0,s.jsx)(c,{onLoginSuccess:()=>{S(!0)}})})}},1068:function(){},622:function(e,t,r){"use strict";var s=r(2265),n=Symbol.for("react.element"),a=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),o=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,r){var s,l={},c=null,d=null;for(s in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,s)&&!i.hasOwnProperty(s)&&(l[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===l[s]&&(l[s]=t[s]);return{$$typeof:n,type:e,key:c,ref:d,props:l,_owner:o.current}}t.jsx=l,t.jsxs=l},7437:function(e,t,r){"use strict";e.exports=r(622)}},function(e){e.O(0,[428,971,938,744],function(){return e(e.s=8343)}),_N_E=e.O()}]);