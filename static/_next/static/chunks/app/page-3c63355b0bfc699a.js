(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8343:function(e,t,r){Promise.resolve().then(r.bind(r,3043))},3043:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var o=r(7437),n=r(2265);r(1068);var i=e=>{let{messages:t,messagesEndRef:r}=e,[i,s]=(0,n.useState)(!1),a=e=>{navigator.clipboard.writeText(e).then(()=>{console.log("Text copied to clipboard"),s(!0),setTimeout(()=>s(!1),2e3)},e=>console.error("Could not copy text: ",e))};return(0,o.jsxs)("div",{style:{height:"450px",overflowY:"auto",marginBottom:"10px",padding:"10px",border:"1px solid #ccc",borderRadius:"8px",whiteSpace:"pre-wrap"},children:[t.map((e,t)=>(0,o.jsx)("div",{style:{textAlign:"user"===e.type?"right":"left",margin:"10px 0"},children:"image"===e.type?(0,o.jsx)("img",{src:e.imageUrl,alt:"Uploaded",style:{margin:"0 0 0 auto",maxWidth:"200px",maxHeight:"200px",borderRadius:"8px"}}):(0,o.jsx)("span",{style:{padding:"10px",borderRadius:"20px",background:"user"===e.type?"#007bff":"#eee",color:"user"===e.type?"white":"black",display:"inline-block",maxWidth:"70%",wordWrap:"break-word",fontSize:"思考中......"===e.text?"13px":"15px",fontStyle:"思考中......"===e.text?"italic":"normal",cursor:"default"},onClick:()=>a(e.text),children:e.text})},t)),i&&(0,o.jsx)("div",{style:{fontSize:"13px",position:"fixed",bottom:"50px",left:"50%",transform:"translateX(-50%)",background:"green",color:"white",padding:"8px",borderRadius:"4px",zIndex:1e3},children:"已复制到剪贴板"}),(0,o.jsx)("div",{ref:r})]})},s=e=>{let{onUpload:t}=e,[r,i]=(0,n.useState)(null),s=[".txt",".docx",".pdf"];return(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:"10px"},children:[(0,o.jsx)("input",{type:"file",accept:s.join(","),onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&(r.size>5242880?(alert("文件大小不能超过5MB！"),e.target.value="",i(null)):i(r))},style:{marginRight:"10px",fontSize:"14px",padding:"6px",borderRadius:"5px",border:"1px solid #ccc"},title:"支持格式: ".concat(s.map(e=>"".concat(e)).join("/"))}),(0,o.jsx)("button",{onClick:()=>{r?t(r):alert("请选择一个文件上传！")},style:{padding:"6px 10px",marginRight:"5px",borderRadius:"5px",border:"1px solid #ccc",background:"#004080",color:"white",fontSize:"14px",cursor:"pointer"},children:"上传文件"})]})};let a="https://chatbot-n.azurewebsites.net/";function l(){let[e,t]=(0,n.useState)([]),[r,l]=(0,n.useState)(""),[c,d]=(0,n.useState)(!1),p=(0,n.useRef)(null);(0,n.useEffect)(()=>{document.title="Chatbot 私有文档助手"},[]);let u=()=>{var e;null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{u()},[e]);let[x,f]=(0,n.useState)(""),[h,g]=(0,n.useState)({});(0,n.useEffect)(()=>{fetch(a+"prompts",{credentials:"include"}).then(e=>e.json()).then(e=>{g(e),e&&Object.keys(e).length>0&&f(Object.keys(e)[0])}).catch(e=>console.error("Error fetching prompts:",e))},[]);let m=async e=>{let t=new FormData;t.append("file",e);try{(await fetch(a+"upload",{method:"POST",body:t,credentials:"include"})).ok?(alert("文件上传成功！较长文档需等待系统处理10秒以上再检索。"),f("1")):alert("文件上传失败！")}catch(e){console.error("上传错误:",e)}},y=async()=>{let e=Date.now();t(t=>[...t,{type:"user",text:r},{type:"system",text:"思考中......",id:e}]),d(!0);try{let o=await fetch(a+"message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_input:r,prompt_template:x}),credentials:"include"});if(!o.ok)throw Error("HTTP error! status: ".concat(o.status));let n=await o.json();t(t=>t.map(t=>t.id===e?{...t,text:n}:t))}catch(e){console.error("Error sending message:",e)}l(""),d(!1)};return(0,o.jsx)("div",{style:{display:"flex",height:"100vh",alignItems:"center",justifyContent:"center"},children:(0,o.jsxs)("div",{style:{width:"80%",maxWidth:"600px"},children:[(0,o.jsx)(i,{messages:e,messagesEndRef:p})," ",(0,o.jsxs)("div",{style:{display:"flex",marginBottom:"10px",alignItems:"center"},children:[(0,o.jsx)("select",{value:x,onChange:e=>f(e.target.value),className:"custom-select",children:Object.entries(h).map((e,t)=>{let[r,n]=e;return(0,o.jsx)("option",{value:t,children:"string"==typeof n?n:String(n)},r)})}),(0,o.jsx)("textarea",{value:r,onChange:e=>l(e.target.value),style:{fontSize:"14px",flex:1,padding:"6px",paddingLeft:"10px",borderRadius:"5px",border:"1px solid #ccc",marginRight:"5px"},disabled:c,rows:3,placeholder:"在此输入..."}),(0,o.jsx)("button",{onClick:y,style:{padding:"5px",borderRadius:"5px",border:"1px solid #ccc",background:c?"#ccc":"#007bff",color:c?"#666":"white",width:"70px",marginRight:"5px",fontSize:"14px"},disabled:c,children:c?"已发送":"发送"})]}),(0,o.jsx)(s,{onUpload:m})," "]})})}},1068:function(){},622:function(e,t,r){"use strict";var o=r(2265),n=Symbol.for("react.element"),i=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),s=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,r){var o,l={},c=null,d=null;for(o in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)i.call(t,o)&&!a.hasOwnProperty(o)&&(l[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===l[o]&&(l[o]=t[o]);return{$$typeof:n,type:e,key:c,ref:d,props:l,_owner:s.current}}t.jsx=l,t.jsxs=l},7437:function(e,t,r){"use strict";e.exports=r(622)}},function(e){e.O(0,[428,971,938,744],function(){return e(e.s=8343)}),_N_E=e.O()}]);